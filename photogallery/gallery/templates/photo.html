{% extends "base.html" %}
{% load staticfiles %}

{% block title %}{{ photo.title }}{% endblock %}
{% block header %}
  {% if photo.next_photo %}
    <link rel="next" href="{% url 'gallery:photo' photo.next_photo.slug %}">
    <link rel="prefetch" href="{% url 'gallery:photo' photo.next_photo.slug %}">
    <link rel="prerender" href="{% url 'gallery:photo' photo.next_photo.slug %}">
  {% endif %}
  {% if photo.previous_photo %}
    <link rel="prev" href="{% url 'gallery:photo' photo.previous_photo.slug %}">
  {% endif %}
{% endblock %}

{% if user.is_authenticated %}
  {% block navbar %}
    <div class="ui divider"></div>
    <div class="header">Kuva</div>
    <a class="item" href="{% url 'gallery:album-update-cover' album_id=photo.album.pk photo_id=photo.pk %}">
      Aseta oletuskuvaksi
    </a>
    <a class="item" href="{% url 'gallery:photo-edit' photo.slug %}">Muokkaa</a>
    <a class="item" href="#" id="photo-delete">Poista</a>
    <div class="ui divider"></div>
    <div class="header">Albumi</div>
    <a class="item" href="{% url 'gallery:album-edit' photo.album.directory %}">Muokkaa</a>
    <a class="item" href="#" id="album-delete">Poista</a>
  {% endblock %}
{% endif %}

{% block content %}
  <div class="ui container">

    <div class="ui basic clearing segment">
      <div class="ui breadcrumb">
        <a class="section">Etusivu</a>
        {% if photo.album.parent %}
          <i class="grey right angle icon divider"></i>
          <a class="section"
             href="{% url 'gallery:album' photo.album.parent.directory %}">{{ photo.album.parent.title }}</a>
        {% endif %}
        <i class="grey right angle icon divider"></i>
        <a class="section" href="{% url 'gallery:album' photo.album.directory %}">{{ photo.album.title }}</a>
      </div>
    </div>

    <div class="ui centered stackable grid">
      <div class="nine wide column">
        <div id="photonav" class="ui basic clearing segment">
          {% if photo.next_photo %}
            <a href="{% url 'gallery:photo' photo.next_photo.slug %}">
              <div class="ui right floated right labeled icon button">Seuraava
                <i class="right chevron icon"></i>
              </div>
            </a>
          {% endif %}
          {% if photo.previous_photo %}
            <a href="{% url 'gallery:photo' photo.previous_photo.slug %}">
              <div class="ui left floated left labeled icon button">Edellinen
                <i class="left chevron icon"></i>
              </div>
            </a>
          {% endif %}
        </div>
      </div>
    </div>

    <div id="photo" class="ui basic segment">
      {% if photo.preview_img %}
        <img class="ui fluid image centered" src="{{ photo.preview_img.url }}"
                {% if photo.hidpi_preview_img %}
             srcset="{{ photo.hidpi_preview_img.url }} 2x"
                {% endif %}
             alt="{{ photo.title }}">
      {% else %}
        <img class="ui fluid image centered" src="{{ photo.image.url }}"
             alt="{{ photo.title }}">
      {% endif %}
    </div>

    {% if photo.description %}
      <div class="ui center aligned basic segment">
        <p>{{ photo.description }}</p>
      </div>
    {% endif %}
  </div>
{% endblock %}

{% block modals %}
  {% if user.is_authenticated %}
    <div class="ui small modal album-delete" id="album-delete">
      <div class="header">
        Poista albumi
      </div>
      <div class="content">
        <p>Poistetaanko albumi "{{ photo.album.title }}" ja kaikki sen alla olevat kuvat?</p>
      </div>
      <div class="actions">
        <form action="{% url 'gallery:album-delete' photo.album.directory %}" method="post">
          {% csrf_token %}
          <div class="ui cancel button">
            Peruuta
          </div>
          <input class="ui negative button" type="submit" value="Poista"/>
        </form>
      </div>
    </div>

    <div class="ui small modal photo-delete" id="photo-delete">
      <div class="header">
        Poista kuva
      </div>
      <div class="content">
        <p>Poistetaanko kuva "{{ photo.title }}"?</p>
      </div>
      <div class="actions">
        <form action="{% url 'gallery:photo-delete' photo.slug %}" method="post">
          {% csrf_token %}
          <div class="ui cancel button">
            Peruuta
          </div>
          <input class="ui negative button" type="submit" value="Poista"/>
        </form>
      </div>
    </div>
  {% endif %}
{% endblock %}

{% block scripts %}
  {% if user.is_authenticated %}
    <script>
        $('.ui.small.modal.album-delete')
            .modal('setting', 'duration', 0)
            .modal('attach events', '#album-delete', 'show')
        ;

        $('.ui.small.modal.photo-delete')
            .modal('setting', 'duration', 0)
            .modal('attach events', '#photo-delete', 'show')
        ;
    </script>
  {% endif %}
{% endblock %}
